{"version":3,"sources":["../source/Form.js"],"names":["React","Component","PropTypes","classNames","Button","Form","submit","bind","on_key_down","props","post","error","className","style","markup","render_children","children","form_elements","Children","toArray","error_element","index","child","type","Error","cloneElement","key","Actions","insert_at","push","event","preventDefault","busy","keyCode","cancel","propTypes","func","oneOfType","string","bool","node","isRequired","object","defaultProps","rrui__modal","context","register_form","unregister_form","close_if_not_busy","closeLabel","contextTypes"],"mappings":"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","file":"Form.js","sourcesContent":["import React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport classNames from 'classnames'\r\n\r\nimport Button from './Button'\r\n\r\n// Prevents `<form/> submission when `busy` is `true`.\r\n// And also inserts `<Form.Error/>` when `error` is passed.\r\n// Using `Component` here instead of `PureComponent`\r\n// because `<Form.Actions>` depends on `context` and therefore\r\n// should be rerendered even if the `props` haven't changed.\r\n// And probably that was also why it would keep displaying an old error\r\n// (and not resetting it for some reason).\r\nexport default class Form extends Component\r\n{\r\n\tstatic propTypes =\r\n\t{\r\n\t\t// `onSubmit` handler\r\n\t\tsubmit      : PropTypes.func,\r\n\r\n\t\t// On `Escape` keydown handler\r\n\t\tcancel      : PropTypes.func,\r\n\r\n\t\t// `error` can be passed for non-javascript old-school forms.\r\n\t\t// e.g. when a form submitted via HTTP POST request had an error,\r\n\t\t// then this error is rendered as part of the form.\r\n\t\terror       : PropTypes.oneOfType([PropTypes.string, PropTypes.bool, PropTypes.node]),\r\n\r\n\t\t// The HTML form `action` attribute,\r\n\t\t// i.e. the URL to which the form will be posted\r\n\t\t// in case of a non-javascript old-school POST submission.\r\n\t\tpost        : PropTypes.string,\r\n\r\n\t\t// Is form submission in progress\r\n\t\tbusy        : PropTypes.bool.isRequired,\r\n\r\n\t\t// CSS class\r\n\t\tclassName   : PropTypes.string,\r\n\r\n\t\t// CSS style object\r\n\t\tstyle       : PropTypes.object\r\n\t}\r\n\r\n\tstatic defaultProps =\r\n\t{\r\n\t\tbusy : false\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper()\r\n\r\n\t\tthis.submit      = this.submit.bind(this)\r\n\t\tthis.on_key_down = this.on_key_down.bind(this)\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst { post, error, className, style } = this.props\r\n\r\n\t\tconst markup =\r\n\t\t(\r\n\t\t\t<form\r\n\t\t\t\tonSubmit={ this.submit }\r\n\t\t\t\tonKeyDown={ this.on_key_down }\r\n\t\t\t\taction={ post }\r\n\t\t\t\tmethod=\"POST\"\r\n\t\t\t\tclassName={ classNames('rrui__form', className) }\r\n\t\t\t\tstyle={ style }\r\n\t\t\t\tnoValidate>\r\n\r\n\t\t\t\t{ this.render_children(error) }\r\n\t\t\t</form>\r\n\t\t)\r\n\r\n\t\treturn markup\r\n\t}\r\n\r\n\t// Adds `error` element to the form\r\n\trender_children(error)\r\n\t{\r\n\t\tconst { children } = this.props\r\n\r\n\t\tconst form_elements = React.Children.toArray(children)\r\n\r\n\t\t// Insert `error` element\r\n\t\tif (error)\r\n\t\t{\r\n\t\t\t// Will be set to `null` upon insertion\r\n\t\t\tlet error_element = <Form.Error key=\"form-error\">{ error }</Form.Error>\r\n\r\n\t\t\t// Show form error above form actions,\r\n\t\t\t// so that the error will be visible and won't be overlooked.\r\n\t\t\tlet index = 0\r\n\t\t\tfor (let child of form_elements)\r\n\t\t\t{\r\n\t\t\t\tif (child.type === Form.Error)\r\n\t\t\t\t{\r\n\t\t\t\t\tform_elements[index] = React.cloneElement(child, { key: 'form-error' }, error)\r\n\t\t\t\t\terror_element = null\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (child.type === Form.Actions)\r\n\t\t\t\t{\r\n\t\t\t\t\tform_elements.insert_at(index, error_element)\r\n\t\t\t\t\terror_element = null\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tindex++\r\n\t\t\t}\r\n\r\n\t\t\tif (error_element)\r\n\t\t\t{\r\n\t\t\t\tform_elements.push(error_element)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn form_elements\r\n\t}\r\n\r\n\tsubmit(event)\r\n\t{\r\n\t\tif (event)\r\n\t\t{\r\n\t\t\tevent.preventDefault()\r\n\t\t}\r\n\r\n\t\tconst { busy, submit } = this.props\r\n\r\n\t\t// Prevent form double submit\r\n\t\t// (because not only buttons submit a form,\r\n\t\t//  therefore just disabling buttons is not enough).\r\n\t\tif (busy)\r\n\t\t{\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (submit)\r\n\t\t{\r\n\t\t\treturn submit()\r\n\t\t}\r\n\t}\r\n\r\n\ton_key_down(event)\r\n\t{\r\n\t\t// Cancel editing on \"Escape\" key\r\n\t\tif (event.keyCode === 27)\r\n\t\t{\r\n\t\t\tconst { cancel } = this.props\r\n\r\n\t\t\tif (cancel)\r\n\t\t\t{\r\n\t\t\t\tcancel()\r\n\t\t\t}\r\n\r\n\t\t\tevent.preventDefault()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nForm.Error = function({ children })\r\n{\r\n\treturn (\r\n\t\t<div className=\"rrui__form__error\">\r\n\t\t\t{ children }\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\n// Using `Component` here instead of `PureComponent`\r\n// because it depends on `context` and therefore should be\r\n// rerendered even if the `props` haven't changed.\r\nForm.Actions = class Actions extends Component\r\n{\r\n\tcomponentWillMount()\r\n\t{\r\n\t\tconst { rrui__modal } = this.context\r\n\r\n\t\tif (rrui__modal)\r\n\t\t{\r\n\t\t\trrui__modal.register_form()\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount()\r\n\t{\r\n\t\tconst { rrui__modal } = this.context\r\n\r\n\t\tif (rrui__modal)\r\n\t\t{\r\n\t\t\trrui__modal.unregister_form()\r\n\t\t}\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst { children, className, style } = this.props\r\n\t\tconst { rrui__modal } = this.context\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={ classNames('rrui__form__actions', className) }\r\n\t\t\t\tstyle={ style }>\r\n\t\t\t\t{ rrui__modal &&\r\n\t\t\t\t\t<Button action={ rrui__modal.close_if_not_busy }>\r\n\t\t\t\t\t\t{ rrui__modal.closeLabel }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}\r\n\t\t\t\t{ children }\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nForm.Actions.contextTypes =\r\n{\r\n\trrui__modal : PropTypes.object\r\n}"]}